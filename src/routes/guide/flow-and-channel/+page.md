---
title: Flow and Channel
---
ここでは、FlowとChannelについて説明します。

## Flow

エージェントを配置し、エージェントの出力チャンネルから入力チャンネルへと接続を行ったものがフローです。

フローはFile > Newメニューから新たに作成することができ、Mnemnk Appは複数のフローを保持できます。
Agentsページの左端にはフローの名前が並んでいます。
選択状態にないフロー内のエージェントも動作を続けていることに注意しましょう。

フローは保存することで、Mnemnk Appを終了しても、次回起動時に自動的に読み込まれます。
実行状態で保存したフローはMnemnk Appの起動時に自動的に開始されることも覚えておきましょう。

### Connection

エージェント間の接続には特に制限はありません。

1つの入力チャンネルに複数のエージェントからの接続を行うことも、1つの出力チャンネルから複数のエージェントへ接続を行うこともできます。

![](/images/guide/flow-and-channel/in-out-channels.png)

1つの出力エージェントから複数の入力チャンネルへの接続がある場合、それらの処理順序は不定であり保証されないことに注意してください。
例えば、上図の`Unit Input`から`Counter`の`in`と`reset`の両方へと接続した場合、`Unit Input`のunitをクリックした際にcountが+1されてから0になるか、0になってから1になるかは不定です。

## Channel

入力チャンネルと出力チャンネルには名前がついています。

これまでも見てきたように、エージェントを接続する際に、入力チャンネルの名前と出力チャンネルの名前を一致させる必要はありません。

入力チャンネル名はエージェントが自身のどのチャンネルからデータが入力されたのかを区別するためであり、接続元の出力チャンネル名には無関係です。[^1]

出力チャンネル名は、複数の出力チャンネルを持つエージェントが、どの出力チャンネルからデータを送り出すかを決めるためのラベルです。[^2]

### Channel `*`

入力チャンネル名のみが使われ、出力チャンネル名は関係ないと述べましたが、入力チャンネル名が`*`のときは例外となります。

入力チャンネル名が`*`のときは、出力チャンネル名がエージェントの`process`に渡されます。[^3]
上図の`Debug Data`の表示をよく見ると、`"ch": "count"`となっていることが分かります。
この`count`は`Counter`エージェントの出力チャンネル名から来ています。

出力チャンネル名が`*`のときは、エージェントのすべての出力がその出力チャンネルから（も）出力されることを表しています。
このときの出力はエージェントが指定したチャンネル名となり、チャンネル名が`*`となるわけではないことに注意してください。

入力チャンネル名が`*`で、かつ、出力チャンネル名も`*`のときも、上記のルールは変わらず、出力側のエージェントが指定したチャンネル名が入力側のエージェントの`process`の呼び出しに使われます。

:::caution
エージェント開発者へ

1入力あるいは1出力のエージェントでも、そのチャンネル名を`*`にすることは避けるべきです。
一見、変わらないように感じるかもしれませんが、将来、エージェントを拡張して新たなチャンネルを追加したときに、これまで構築したフロー内のそのエージェントとの接続が失われてしまう可能性があります。
:::

[^1]: 入力チャンネル名はプログラミング言語における関数`fn f(x, y) ->`のパラメータ名`x`と`y`に相当し、`f(foo, bar)`のように関数を呼び出す際に用いた実引数の名前`foo`と`bar`には全く無関係であるのと同じです。

[^2]: 関数の返り値に名前をつけられる言語としては[Go](https://go.dev/tour/basics/7)があげられます。

[^3]: これはrest propsに似ていますが、「残り」ではなく「全て」のデータが出力されます。