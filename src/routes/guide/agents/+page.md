---
title: Agents
---
エージェントというとAIエージェントのような知的な処理を行うものを想像するかもしれない。

![](/images/guide/agents/chat-model-agent.png)

もちろん、これもエージェントの一種ですが、Mnemnkでは単純なものから知的なものまで、さまざまな処理をすべてエージェントとして統一的に扱います。

例えば、ユーザーからの入力を受け付けるエージェント、受け取ったデータを表示するエージェントといった単純なものから、アクティブなアプリケーションをモニターして変化を出力するエージェント、イベントを受け取りDBに格納するエージェントなど、多様なものがあります。

Mnemnkではこれらのエージェントを組み合わせることで、複雑な処理を行うフローを構築できます。

![](/images/guide/agents/simple-chat-bot.png)

## Agent

エージェントは独立した内部状態を持ち、非同期に並行動作します。
実際にエージェントを用いた簡単なフローを構築しながら、エージェントの動作を説明します。

エージェントはAgentページの右上のAgentsメニューからエージェント名を選ぶことで、フロー上に配置できます。
配置しただけではエージェントはまだ動作せず、暗く半透明に表示されます。

次の例は`Integer Input`、`Memory`、`Display Data`を配置したところです。

![](/images/guide/agents/first-agent-flow1.png)

### Config

各エージェントはその種類に応じた設定を持つことができます。
例えば`Memory`は最大いくつまでの値を記憶するかを設定できます。

この設定の値はFile > Saveメニューから保存するとJSONファイルに保存されます。

一方でDisplay Dataが表示している値のような、エージェントの内部状態はJSONファイルには保存されません。

<Expansion title="Global Config" showIcon={false}>

#### Global Config

APIエージェントのように、エージェントはすべてのインスタンスに共通のglobal configを持つことができます。

global configはSettingsページで設定でき、これはCore Settingsと同様にMnemnk Appの設定として保存されます。

つまり、フローのJSONファイルには保存されないため、DBのアドレスなど、ユーザーやマシンの環境に依存した設定を行うのに適しています。
（コンフィグレーションとしては保存されるので、依然として注意が必要です）

</Expansion>

### チャンネル

エージェントは複数の入力チャンネルと複数の出力チャンネルを持つことができます。

エージェントの左側に並んでいるのが入力チャンネルです。
`Memory`エージェントの`in`と`reset`、`Display Data`エージェントの`data`が入力チャンネルです。

逆に、右側に並んでいるのが出力チャンネルで、
`Integer Input`エージェントの`integer`、`Memory`エージェントの`memory`と`reset`が出力チャンネルです。

これらのチャンネルを接続することでエージェント間の通信が可能になります。

`Integer Input`の`integer`から`Memory`の`in`へ、`Memory`の`memory`から`Display Data`の`data`へと接続したら、画面下のプレイボタン▶を押して動作状態にします。
するとこのように表示されます：

![](/images/guide/agents/first-agent-flow2.png)

`Integer Input`の値を変えると、その度に`Display Data`の表示が更新されます。
`Display Data`には`Memory`が出力する最大10個の直近の値が表示されています。

### エージェントの動作

#### process

エージェントはその動作を規定するメソッド`process`を持っています。
エージェントは入力チャンネルのうち、**どれかひとつに**入力があったとき、入力のあったチャンネルchと受け取ったdataを引数にして`process`が呼び出されます。

:::note
入力チャンネルすべての値が揃ったときに呼び出されるのではありません。
:::

そして、`process`での処理の結果を出力チャンネルへと出力します。
このとき複数の出力チャンネルに異なる出力を行うエージェントも存在します。

![](/images/guide/agents/web-base-loader-agent.png)

また、受け取ったdataによっては`process`の結果として何も出力を行わない場合もあります。

#### フローの実行

Agentページのプレイボタン▶を押すと、表示されているフロー内の各エージェントの`start`が実行され、実行状態に遷移します。
（一部のエージェントだけを選択して実行・停止することもできます）

実行状態のエージェントは、入力チャンネルにデータが送られることによって`process`が呼ばれるのを待ちます。
また、`Application`エージェントや`Screen`エージェントのように、`process`の呼び出しによらず、実行状態において能動的にデータを出力するものもあります。
フローは、このようにエージェントからエージェントへデータが送られることによって実行されます。

<video src="/images/guide/agents/interval-timer.mp4" controls="true" width="720px">interval timer</video>

エージェントはフロー内で1度だけ実行されるのではなく、停止しない限りずっと実行状態であり続け、入力を受けるたびに`process`が呼び出されます。

#### 並行動作

各エージェントはそれぞれ独立に動作します。
あるエージェントの処理が重く`process`を実行し続けていても、他のエージェントの`process`の呼び出しをブロックしません。

各エージェントはそれぞれがイベントループを持ち、ひとつのエージェント内で`process`が同時に呼び出されることはありません。
`process`の処理中に新たなデータが入力されると、そのデータは一旦イベントキューに置かれます。

:::tip
技術的には各エージェントはそれぞれが独立したイベントループを持つ[tokio::task](https://docs.rs/tokio/latest/tokio/task/)として動作しています。
:::
