---
title: Flow and Channel
---
ここでは、FlowとChannelについて説明する。

## Flow

エージェントを配置し、エージェントの出力チャンネルから入力チャンネルへと接続を行ったものがフローである。

フローはFile > Newメニューから新たに作成することができ、Mnemnk Appは複数のフローを保持できる。
Agentsページの左端にはフローの名前が並んでいる。
選択状態にないフロー内のエージェントも動作を続けていることに注意すべきである。

フローは保存することで、次回起動時に自動的に読み込まれる。

:::note
実行状態で保存したフローはMnemnk Appの次回起動時にも自動的に開始される。
:::

### Connection

エージェント間の接続には特に制限はない。

1つの入力チャンネルに複数のエージェントからの接続を行うことも、1つの出力チャンネルから複数のエージェントへ接続を行うこともできる。

![](/images/guide/flow-and-channel/in-out-channels.png)

エージェントは入力チャンネルにデータが送られてきたときに`process`が呼び出され、任意のタイミングで出力を行う。

1つの出力エージェントから複数の接続が出ているとき、それらへのデータの出力順序は不定であり保証されないことに注意すべきである。
例えば、上図の`Unit Input`から`Counter`の`in`と`reset`の両方へと接続した場合、`Unit Input`のunitをクリックした際にcountが+1されてから0になるか、0になってから1になるかは不定である。

## Channel

入力チャンネルと出力チャンネルには名前がついている。

これらの名前はどのようなデータを受け取り、どのようなデータを出力するかのヒントでしかない。
これまでも見てきたように、エージェントを接続する際に、入力チャンネルの名前と出力チャンネルの名前を一致させる必要はない。

入力チャンネル名はエージェントが自身のどのチャンネルからデータが入力されたのかを区別するためであり、接続元の出力チャンネル名には無関係である。[^1]

出力チャンネル名は、複数の出力チャンネルを持つエージェントが、どの出力チャンネルからデータを送り出すかを決めるためのラベルである。[^2]

### Channel `*`

#### 入力チャンネル `*`

入力チャンネル名のみが使われ、出力チャンネル名は関係ないと述べたが、入力チャンネル名が`*`のときは例外となる。

入力チャンネル名が`*`のときは、出力チャンネル名がエージェントの`process`に渡される。[^3]
上図の`Debug Data`の表示をよく見ると、`"ch": "count"`となっていることがわかる。
この`count`は`Counter`エージェントの出力チャンネル名から来ている。

出力側のチェンネル名を知る必要があるに入力チャンネル名`*`が用いられる。
（ex. `Board In`エージェント、`Debug Data`エージェント）

#### 出力チャンネル `*`

出力チャンネル名が`*`のときは、エージェントのすべての出力がその出力チャンネルから（も）出力されることを表している。
このときの出力はエージェントがデータを出力する際に指定したチャンネル名となり、チャンネル名が`*`となるわけではないことに注意すべきである。

エージェントが多種多様なデータを同じ出力したい場合に出力チャンネル名`*`が用いられる。
（ex. `Board Out`エージェント、`API`エージェント）

#### 両側が `*`

入力チャンネル名が`*`で、かつ、出力チャンネル名も`*`のときも同じである。
上記のルールに従い、出力側のエージェントが指定したチャンネル名が、入力側のエージェントの`process`の呼び出しに使われる。

:::caution
エージェント開発者へ

1入力あるいは1出力のエージェントでも、そのチャンネル名を安易に`*`にすることは避けるべきである。
ここで述べたルールが必要な特別なときだけ`*`を使うべきである。
:::

[^1]: 入力チャンネル名はプログラミング言語における関数`fn f(x, y) ->`のパラメータ名`x`と`y`に相当し、`f(foo, bar)`のように関数を呼び出す際に用いた変数の名前`foo`と`bar`には全く無関係であるのと同じである。

[^2]: 関数の返り値に名前をつけられる言語は珍しいが、[Go](https://go.dev/tour/basics/7)では可能である。

[^3]: これはrest propsに似ている。
